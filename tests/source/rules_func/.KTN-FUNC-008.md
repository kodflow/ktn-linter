# RÃ¨gle : KTN-FUNC-008 - Commentaires sur Return Statements

## ğŸ“‹ Description

Tous les return statements en Go doivent avoir un **commentaire explicatif juste au-dessus** qui explique ce qui est retournÃ© et pourquoi.

## ğŸ¯ Objectif

**Pourquoi cette rÃ¨gle existe :**
- **ClartÃ©** : Comprendre immÃ©diatement ce que retourne chaque branche
- **MaintenabilitÃ©** : Les commentaires facilitent la comprÃ©hension lors des modifications
- **Documentation** : Chaque dÃ©cision de retour est explicitement documentÃ©e
- **DÃ©bogage** : Identifier rapidement quel return a Ã©tÃ© exÃ©cutÃ©
- **Revue de code** : Les reviewers comprennent l'intention de chaque return

## âœ… Bonne Pratique (target/)

```go
// MultipleReturnsWithComments a plusieurs returns avec commentaires.
//
// Params:
//   - value: la valeur Ã  vÃ©rifier
//
// Returns:
//   - int: la valeur traitÃ©e
//   - error: erreur Ã©ventuelle
func MultipleReturnsWithComments(value int) (int, error) {
	if value < 0 {
		// Erreur car valeur nÃ©gative non autorisÃ©e
		return 0, errors.New("negative value")
	}

	if value == 0 {
		// Retourne 0 sans erreur pour une valeur nulle
		return 0, nil
	}

	// Retourne le double de la valeur
	return value * 2, nil
}

// SwitchWithReturnComments utilise switch avec commentaires sur returns.
//
// Params:
//   - status: le code de statut
//
// Returns:
//   - string: message correspondant
func SwitchWithReturnComments(status int) string {
	switch status {
	case 200:
		// Retourne "OK" pour un statut HTTP 200
		return "OK"
	case 404:
		// Retourne "Not Found" pour un statut HTTP 404
		return "Not Found"
	case 500:
		// Retourne "Internal Error" pour un statut HTTP 500
		return "Internal Error"
	default:
		// Retourne "Unknown" pour tous les autres statuts
		return "Unknown"
	}
}

// EarlyReturnWithComment fait un early return avec commentaire.
//
// Params:
//   - data: les donnÃ©es Ã  valider
//
// Returns:
//   - error: erreur de validation
func EarlyReturnWithComment(data []string) error {
	if len(data) == 0 {
		// Erreur car les donnÃ©es sont vides
		return errors.New("empty data")
	}

	for _, item := range data {
		if item == "" {
			// Erreur car un Ã©lÃ©ment est vide
			return errors.New("empty item")
		}
	}

	// SuccÃ¨s car toutes les validations sont passÃ©es
	return nil
}
```

### Pourquoi c'est bon :
- âœ… **Commentaire juste au-dessus** : Chaque return a son commentaire sur la ligne prÃ©cÃ©dente
- âœ… **Explication claire** : On comprend ce qui est retournÃ© et pourquoi
- âœ… **Tous les returns** : Aucun return n'est oubliÃ© (error, success, edge cases)
- âœ… **Cas complexes** : MÃªme les switch/case sont documentÃ©s
- âœ… **Early returns** : Les sorties anticipÃ©es sont clairement expliquÃ©es

## âŒ Mauvaise Pratique (source/)

```go
// âŒ ERREUR: Return simple sans commentaire
func simpleReturnWithoutComment() string {
	return "Hello" // âŒ KTN-FUNC-008: Pas de commentaire au-dessus du return
}

// âŒ ERREUR: Multiple returns sans commentaires
func multipleReturnsNoComments(value int) (int, error) {
	if value < 0 {
		return 0, errors.New("negative value") // âŒ Pas de commentaire
	}

	if value == 0 {
		return 0, nil // âŒ Pas de commentaire
	}

	return value * 2, nil // âŒ Pas de commentaire
}

// âŒ ERREUR: Switch sans commentaires sur returns
func switchWithoutReturnComments(status int) string {
	switch status {
	case 200:
		return "OK" // âŒ Pas de commentaire
	case 404:
		return "Not Found" // âŒ Pas de commentaire
	default:
		return "Unknown" // âŒ Pas de commentaire
	}
}

// âŒ ERREUR: Early returns sans commentaires
func earlyReturnWithoutComment(data []string) error {
	if len(data) == 0 {
		return errors.New("empty data") // âŒ Pas de commentaire
	}

	for _, item := range data {
		if item == "" {
			return errors.New("empty item") // âŒ Pas de commentaire
		}
	}

	return nil // âŒ Pas de commentaire
}
```

### Pourquoi c'est mauvais :
- âŒ **Manque de contexte** : On ne sait pas pourquoi ce return est lÃ 
- âŒ **Difficile Ã  dÃ©boguer** : Impossible de savoir rapidement quel return a Ã©tÃ© exÃ©cutÃ©
- âŒ **Revue de code difficile** : Les reviewers doivent dÃ©duire l'intention
- âŒ **Maintenance complexe** : Les futurs dÃ©veloppeurs doivent analyser le code
- âŒ **Perte de logique mÃ©tier** : L'intention derriÃ¨re chaque return est perdue

## ğŸ” DÃ©tection du Linter

### Code d'erreur

| Code | Description |
|------|-------------|
| `KTN-FUNC-008` | Return statement sans commentaire explicatif |

### Message d'erreur

```
[KTN-FUNC-008] Return statement sans commentaire explicatif.
Tout return doit avoir un commentaire juste au-dessus expliquant ce qui est retournÃ©.
Exemple:
  // Erreur de traitement
  return err

  // SuccÃ¨s
  return nil
```

### Ce que le linter vÃ©rifie :

1. **Tous les returns** : Aucun return ne peut Ãªtre sans commentaire
2. **Position du commentaire** : Le commentaire doit Ãªtre sur la ligne juste au-dessus du return
3. **Pas d'exception** : S'applique Ã  tous les types de returns (error, success, valeurs)
4. **Structures complexes** : Switch, if/else imbriquÃ©s, early returns, etc.

## ğŸ¤– Prompt IA

Pour qu'une IA comprenne et applique cette rÃ¨gle automatiquement :

```
Tu es un expert Go. VÃ©rifie que TOUS les return statements respectent la rÃ¨gle KTN-FUNC-008 :

RÃˆGLE OBLIGATOIRE - COMMENTAIRE SUR RETURN :
- CHAQUE return doit avoir un commentaire juste au-dessus
- Le commentaire doit Ãªtre sur la ligne prÃ©cÃ©dant immÃ©diatement le return
- Format : // Description de ce qui est retournÃ© et pourquoi
- Exemple : // Erreur de validation / // SuccÃ¨s / // Retourne la valeur calculÃ©e

DÃ‰TECTION D'ERREURS :
- Si un return n'a pas de commentaire juste au-dessus â†’ ERREUR KTN-FUNC-008

TYPES DE RETURNS Ã€ COMMENTER :
1. Return simple : return value
2. Return avec erreur : return nil, err
3. Return dans if/else : tous les returns de toutes les branches
4. Return dans switch : tous les case et default
5. Early return : return anticipÃ© pour validation
6. Return dans boucle : return Ã  l'intÃ©rieur d'un for/range

Pour corriger le code :
1. Identifie TOUS les return statements de la fonction
2. Pour CHAQUE return, ajoute un commentaire sur la ligne juste au-dessus
3. Le commentaire doit expliquer CE QUI est retournÃ© et POURQUOI

EXEMPLE PARFAIT :
func Process(value int) error {
    if value < 0 {
        // Erreur car la valeur ne peut pas Ãªtre nÃ©gative
        return errors.New("negative value")
    }

    if value == 0 {
        // SuccÃ¨s car une valeur nulle est valide
        return nil
    }

    // Traitement rÃ©ussi avec la valeur transformÃ©e
    return processValue(value)
}

EXEMPLE INCORRECT :
func Process(value int) error {
    if value < 0 {
        return errors.New("negative value") // âŒ Pas de commentaire au-dessus
    }
    return nil // âŒ Pas de commentaire au-dessus
}
```

## ğŸ“š RÃ©fÃ©rences

- [Effective Go - Commentary](https://go.dev/doc/effective_go#commentary)
- [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments)
- [Google Go Style - Documentation](https://google.github.io/styleguide/go/decisions#documentation)

## ğŸ”„ ScÃ©narios de Test

**Principe d'isolation** : "Tout parfait SAUF l'erreur testÃ©e"

Chaque cas de test est conÃ§u pour dÃ©clencher **UNIQUEMENT** l'erreur KTN-FUNC-008, sans erreurs parasites provenant d'autres rÃ¨gles.

**RÃ©sultats actuels** : 27 erreurs dÃ©tectÃ©es

| # | ScÃ©nario | Fichier | Ligne | RÃ©sultat attendu |
|---|----------|---------|-------|------------------|
| 1 | Return simple sans commentaire | source:10 | 10:2 | âŒ KTN-FUNC-008 |
| 2 | Multiple returns - erreur | source:23 | 23:3 | âŒ KTN-FUNC-008 |
| 3 | Multiple returns - valeur nulle | source:27 | 27:3 | âŒ KTN-FUNC-008 |
| 4 | Multiple returns - cas normal | source:30 | 30:2 | âŒ KTN-FUNC-008 |
| 5 | Conditions complexes - very large | source:44 | 44:4 | âŒ KTN-FUNC-008 |
| 6 | Conditions complexes - large | source:46 | 46:3 | âŒ KTN-FUNC-008 |
| 7 | Conditions complexes - equal | source:50 | 50:3 | âŒ KTN-FUNC-008 |
| 8 | Conditions complexes - small | source:53 | 53:2 | âŒ KTN-FUNC-008 |
| 9 | Switch case 200 | source:66 | 66:3 | âŒ KTN-FUNC-008 |
| 10 | Switch case 404 | source:68 | 68:3 | âŒ KTN-FUNC-008 |
| 11 | Switch case 500 | source:70 | 70:3 | âŒ KTN-FUNC-008 |
| 12 | Switch default | source:72 | 72:3 | âŒ KTN-FUNC-008 |
| 13 | Early return - empty data | source:86 | 86:3 | âŒ KTN-FUNC-008 |
| 14 | Early return - empty item | source:91 | 91:4 | âŒ KTN-FUNC-008 |
| 15 | Early return - success | source:94 | 94:2 | âŒ KTN-FUNC-008 |
| 16 | Nested returns - niveau 3 | source:110 | 110:5 | âŒ KTN-FUNC-008 |
| 17 | Nested returns - niveau 2 | source:112 | 112:4 | âŒ KTN-FUNC-008 |
| 18 | Nested returns - niveau 1 | source:114 | 114:3 | âŒ KTN-FUNC-008 |
| 19 | Nested returns - base | source:116 | 116:2 | âŒ KTN-FUNC-008 |
| 20 | Error handling - negative | source:130 | 130:3 | âŒ KTN-FUNC-008 |
| 21 | Error handling - too large | source:134 | 134:3 | âŒ KTN-FUNC-008 |
| 22 | Error handling - adjusted | source:139 | 139:3 | âŒ KTN-FUNC-008 |
| 23 | Error handling - normal | source:142 | 142:2 | âŒ KTN-FUNC-008 |
| 24 | Boolean logic - active | source:156 | 156:3 | âŒ KTN-FUNC-008 |
| 25 | Boolean logic - pending | source:160 | 160:3 | âŒ KTN-FUNC-008 |
| 26 | Boolean logic - disabled | source:164 | 164:3 | âŒ KTN-FUNC-008 |
| 27 | Boolean logic - inactive | source:167 | 167:2 | âŒ KTN-FUNC-008 |
| âœ… | Code parfait - Tous les returns commentÃ©s | target.go | - | âœ… Aucune erreur |

## ğŸ’¡ Notes

### Exceptions acceptÃ©es

**Aucune exception.** Cette rÃ¨gle s'applique Ã  :
- âœ… Tous les returns (valeur simple, multiple, error, nil)
- âœ… Tous les contextes (if, else, switch, for, defer)
- âœ… Toutes les fonctions (exportÃ©es ET privÃ©es)
- âœ… Tous les types de retour (primitifs, structs, interfaces, pointeurs)

### Cas particuliers

**Defer avec return** : Les returns dans defer doivent aussi Ãªtre commentÃ©s :
```go
func example() (err error) {
	defer func() {
		if r := recover(); r != nil {
			// Erreur rÃ©cupÃ©rÃ©e depuis panic
			err = fmt.Errorf("panic: %v", r)
		}
	}()
	// ...
}
```

**Anonymous functions** : Les returns dans les fonctions anonymes suivent la mÃªme rÃ¨gle :
```go
func example() {
	fn := func() error {
		// Retourne une erreur de test
		return errors.New("test")
	}
	// ...
}
```

### Bonnes pratiques

**Commentaires descriptifs** :
- âŒ `// return` (trop vague)
- âŒ `// retourne` (juste une traduction)
- âœ… `// Erreur car la validation a Ã©chouÃ©`
- âœ… `// SuccÃ¨s aprÃ¨s traitement complet`
- âœ… `// Retourne la valeur par dÃ©faut car aucune configuration n'est trouvÃ©e`

**Position prÃ©cise** :
```go
// âœ… CORRECT - Commentaire juste au-dessus
if err != nil {
    // Erreur de connexion Ã  la base de donnÃ©es
    return nil, err
}

// âŒ INCORRECT - Commentaire trop loin
if err != nil {
    // Erreur de connexion

    return nil, err  // âŒ Ligne vide entre commentaire et return
}
```

## ğŸ“ Formation

### Pour les dÃ©veloppeurs

Cette rÃ¨gle vous oblige Ã  :
1. **RÃ©flÃ©chir** Ã  chaque dÃ©cision de return
2. **Documenter** l'intention derriÃ¨re chaque sortie de fonction
3. **Faciliter** la maintenance et le dÃ©bogage
4. **AmÃ©liorer** la qualitÃ© globale du code

### Pour les reviewers

Lors de la revue de code, vÃ©rifiez que :
- Tous les returns ont un commentaire explicatif
- Les commentaires expliquent le "pourquoi", pas le "quoi"
- Les commentaires sont prÃ©cis et utiles
- Aucun return n'est oubliÃ© (switch, nested if, etc.)
