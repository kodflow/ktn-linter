# R√®gle : Fonctions (Natives)

## üìã Description

Les fonctions natives (non li√©es √† un struct) en Go doivent respecter des standards stricts de **nommage**, **documentation**, **structure** et **complexit√©**.

**Note** : Ces r√®gles s'appliquent uniquement aux fonctions natives (`func Name(...)`), pas aux m√©thodes (`func (r Receiver) Method(...)`).

## üéØ Objectif

**Pourquoi ces r√®gles existent :**
- **Lisibilit√©** : Code uniforme et pr√©visible
- **Maintenabilit√©** : Documentation claire pour tous les d√©veloppeurs
- **Performance** : Fonctions courtes et peu complexes
- **Testabilit√©** : Fonctions simples = tests simples
- **Standards Go** : Conventions officielles Effective Go et Google Go Style Guide
- **Qualit√©** : Limite stricte de complexit√© (< 10) et longueur (< 35 lignes)

## ‚úÖ Bonne Pratique (functions.go - target)

```go
// ProcessData traite les donn√©es fournies et retourne une erreur si √©chec
func ProcessData(data string) error {
	if data == "" {
		return errors.New("data vide")
	}
	return nil
}

// FetchUserData r√©cup√®re les donn√©es utilisateur depuis une source externe
// Retourne une erreur si l'utilisateur n'existe pas ou si le contexte expire
func FetchUserData(ctx context.Context, userID int) (string, error) {
	select {
	case <-ctx.Done():
		return "", ctx.Err()
	default:
		if userID <= 0 {
			return "", errors.New("userID invalide")
		}
		return "user data", nil
	}
}

// calculateTotal est une fonction priv√©e bien document√©e
// Elle calcule le total en additionnant les valeurs
func calculateTotal(values []int) int {
	total := 0
	for _, v := range values {
		total += v
	}
	return total
}
```

### Pourquoi c'est bon :
- ‚úÖ **Noms en MixedCaps/mixedCaps** : ProcessData, FetchUserData, calculateTotal
- ‚úÖ **Commentaire godoc** : TOUTES les fonctions document√©es (export√©es ET priv√©es)
- ‚úÖ **Params document√©s** : Si > 2 param√®tres, mentionn√©s dans la doc
- ‚úÖ **Returns document√©s** : "Retourne une erreur si..."
- ‚úÖ **‚â§ 5 param√®tres** : Respect√© partout
- ‚úÖ **< 35 lignes** : Fonctions courtes et focalis√©es
- ‚úÖ **< 10 complexit√©** : Logique simple sans imbrications profondes

## ‚ùå Mauvaise Pratique (functions.go - source)

```go
// ‚ùå ERREUR 1: snake_case interdit
func parse_http_request(data string) error {
	return nil
}

// ‚ùå ERREUR 2: Fonction export√©e sans commentaire godoc
func ProcessOrder(orderID int) error {
	return nil
}

// ‚ùå ERREUR 3: Param√®tres non document√©s dans godoc
// CreateUser cr√©e un nouvel utilisateur
// Retourne l'ID du nouvel utilisateur ou une erreur
func CreateUser(name string, email string, age int) (int, error) {
	return 1, nil
}

// ‚ùå ERREUR 4: Retours non document√©s
// FetchUserData r√©cup√®re les donn√©es utilisateur depuis une source externe
func FetchUserData(ctx context.Context, userID int) (string, error) {
	return "data", nil
}

// ‚ùå ERREUR 5: Trop de param√®tres (6 > 5)
func CreateUserAccount(name string, email string, age int, address string, phone string, active bool) (int, error) {
	return 1, nil
}

// ‚ùå ERREUR 6: Fonction trop longue (> 35 lignes)
func ProcessLargeOrder(ctx context.Context, orderID int) error {
	// ... 41 lignes de code ...
	return nil
}

// ‚ùå ERREUR 7: Complexit√© trop √©lev√©e (>= 10)
func ValidateComplexInput(input string, level int) error {
	// ... 16 points de d√©cision ...
	return nil
}
```

### Pourquoi c'est mauvais :
- ‚ùå **snake_case** : Viole les conventions Go
- ‚ùå **Pas de godoc** : Impossible de g√©n√©rer documentation automatique
- ‚ùå **Params non document√©s** : Ambigu√Øt√© sur le r√¥le des param√®tres
- ‚ùå **Returns non document√©s** : Pas clair ce qui est retourn√©
- ‚ùå **Trop de params** : Difficile √† tester et maintenir
- ‚ùå **Fonction trop longue** : Difficile √† comprendre en un coup d'≈ìil
- ‚ùå **Complexit√© √©lev√©e** : Nombreux chemins d'ex√©cution = bugs potentiels

## üîç D√©tection du Linter

### Codes d'erreur

| Code | Description |
|------|-------------|
| `KTN-FUNC-001` | Nom pas en MixedCaps/mixedCaps (snake_case interdit) |
| `KTN-FUNC-002` | Fonction sans commentaire godoc (export√©e ET priv√©e) |
| `KTN-FUNC-003` | Commentaire godoc incomplet - param√®tres non document√©s |
| `KTN-FUNC-004` | Commentaire godoc incomplet - valeurs de retour non document√©es |
| `KTN-FUNC-005` | Trop de param√®tres (> 5) |
| `KTN-FUNC-006` | Fonction trop longue (> 35 lignes) |
| `KTN-FUNC-007` | Complexit√© cyclomatique trop √©lev√©e (‚â• 10) |

### Messages d'erreur d√©taill√©s

**KTN-FUNC-001** :
```
Fonction 'parse_http_request' n'utilise pas la convention MixedCaps.
Utilisez MixedCaps pour les fonctions export√©es ou mixedCaps pour les priv√©es.
Exemple: calculateTotal au lieu de calculate_total
```

**KTN-FUNC-002** :
```
Fonction 'ProcessOrder' sans commentaire godoc.
Toute fonction doit avoir un commentaire godoc.
Exemple:
  // ProcessOrder traite une commande...
  func ProcessOrder(...) { }
```

**KTN-FUNC-003** :
```
Commentaire godoc de 'CreateUser' ne documente pas les param√®tres: name, email, age.
Documentez chaque param√®tre pour clarifier leur r√¥le.
```

**KTN-FUNC-004** :
```
Commentaire godoc de 'FetchUserData' ne documente pas les valeurs de retour.
Documentez ce que retourne la fonction et dans quels cas.
```

**KTN-FUNC-005** :
```
Fonction 'CreateUserAccount' a trop de param√®tres (6 > 5).
Limitez √† 5 param√®tres maximum. Si n√©cessaire, utilisez une struct de configuration.
Exemple:
  type CreateUserAccountConfig struct { ... }
  func CreateUserAccount(cfg CreateUserAccountConfig) { }
```

**KTN-FUNC-006** :
```
Fonction 'ProcessLargeOrder' est trop longue (41 lignes > 35).
Limitez les fonctions √† 35 lignes maximum. D√©coupez en fonctions plus petites.
```

**KTN-FUNC-007** :
```
Fonction 'ValidateComplexInput' a une complexit√© cyclomatique trop √©lev√©e (16 >= 10).
R√©duisez la complexit√© en extrayant des sous-fonctions ou en simplifiant la logique.
```

### Ce que le linter v√©rifie :

1. **Nommage** : MixedCaps/mixedCaps obligatoire (KTN-FUNC-001)
2. **Documentation** : Godoc obligatoire pour TOUTES les fonctions (export√©es ET priv√©es) (KTN-FUNC-002)
3. **Params document√©s** : Si > 2 param√®tres, les mentionner dans godoc (KTN-FUNC-003)
4. **Returns document√©s** : Si > 1 retour ou retours nomm√©s, les documenter (KTN-FUNC-004)
5. **Limite params** : Maximum 5 param√®tres (KTN-FUNC-005)
6. **Longueur** : Maximum 35 lignes de code (KTN-FUNC-006)
7. **Complexit√©** : Complexit√© cyclomatique < 10 (KTN-FUNC-007)

## üîÑ Sc√©narios de Test

**Principe d'isolation** : "Tout parfait SAUF l'erreur test√©e"

Chaque cas de test est con√ßu pour d√©clencher **UNIQUEMENT** l'erreur sp√©cifique test√©e, sans erreurs parasites provenant d'autres r√®gles. Cette isolation garantit que les tests sont pr√©cis et fiables.

**R√©sultats actuels** : 9 erreurs isol√©es d√©tect√©es
- KTN-FUNC-001 : 2 erreurs (noms en snake_case)
- KTN-FUNC-002 : 2 erreurs (fonctions export√©es sans godoc)
- KTN-FUNC-003 : 1 erreur (params non document√©s)
- KTN-FUNC-004 : 1 erreur (returns non document√©s)
- KTN-FUNC-005 : 1 erreur (trop de param√®tres)
- KTN-FUNC-006 : 1 erreur (fonction trop longue)
- KTN-FUNC-007 : 1 erreur (complexit√© trop √©lev√©e)

| # | Sc√©nario | Fonction | R√©sultat attendu |
|---|----------|----------|------------------|
| 1 | Nom en snake_case | parse_http_request | ‚ùå KTN-FUNC-001 |
| 2 | Nom en Snake_Case mixte | Calculate_Total | ‚ùå KTN-FUNC-001 |
| 3 | Fonction export√©e sans godoc | ProcessOrder | ‚ùå KTN-FUNC-002 |
| 4 | Autre fonction sans godoc | ValidateEmail | ‚ùå KTN-FUNC-002 |
| 5 | Params non document√©s (> 2) | CreateUser | ‚ùå KTN-FUNC-003 |
| 6 | Returns non document√©s (> 1) | FetchUserData | ‚ùå KTN-FUNC-004 |
| 7 | 6 param√®tres (> 5) | CreateUserAccount | ‚ùå KTN-FUNC-005 |
| 8 | 41 lignes (> 35) | ProcessLargeOrder | ‚ùå KTN-FUNC-006 |
| 9 | Complexit√© 16 (>= 10) | ValidateComplexInput | ‚ùå KTN-FUNC-007 |
| ‚úÖ | Code parfait - Toutes les r√®gles | target/functions.go | ‚úÖ Aucune erreur |

## üí° Notes

### Standards stricts

Ces r√®gles sont **plus strictes** que les recommandations Go standard :
- **35 lignes max** (vs 50-80 habituellement)
- **Complexit√© < 10** (vs 15-20 habituellement)
- **Documentation params obligatoire** si > 2 params

### Complexit√© cyclomatique

La complexit√© cyclomatique mesure le nombre de chemins d'ex√©cution :
```go
// Complexit√© = 1 (base)
func Simple() error {
	return nil
}

// Complexit√© = 2 (1 base + 1 if)
func WithIf(x int) error {
	if x > 0 {  // +1
		return nil
	}
	return nil
}

// Complexit√© = 10 (1 base + 9 points de d√©cision)
func Complex(x int) error {
	if x > 0 {      // +1
		if x < 10 { // +1
			for i := 0; i < x; i++ {  // +1
				if i%2 == 0 {          // +1
					// ...
				}
			}
		}
	} else if x < 0 {  // +1
		// ...
	}
	switch x {  // 0 (switch lui-m√™me)
	case 1:     // +1
	case 2:     // +1
	case 3:     // +1
	default:    // 0 (default ne compte pas)
	}
	return nil
}
```

### Documentation minimale

Pour les fonctions avec ‚â§ 2 param√®tres et 1 retour, une documentation simple suffit :
```go
// ‚úÖ OK : simple et clair
// ProcessData traite les donn√©es fournies
func ProcessData(data string) error
```

Pour les fonctions avec > 2 param√®tres ou > 1 retour, documenter en d√©tail :
```go
// ‚úÖ Documentation compl√®te requise
// CreateUser cr√©e un nouvel utilisateur avec validation
// Les param√®tres ctx, name, email, age et active contr√¥lent la cr√©ation
// Retourne l'ID du nouvel utilisateur ou une erreur si validation √©choue
func CreateUser(ctx context.Context, name string, email string, age int, active bool) (int, error)
```

## üìö R√©f√©rences

- [Effective Go - Functions](https://go.dev/doc/effective_go#functions)
- [Effective Go - Commentary](https://go.dev/doc/effective_go#commentary)
- [Go Code Review Comments - Function Names](https://github.com/golang/go/wiki/CodeReviewComments#named-result-parameters)
- [Google Go Style Guide - Decisions](https://google.github.io/styleguide/go/decisions)
- [Cyclomatic Complexity](https://en.wikipedia.org/wiki/Cyclomatic_complexity)
