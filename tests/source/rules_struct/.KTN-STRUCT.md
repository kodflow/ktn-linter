# KTN-STRUCT - Règles pour les structures

Ce document regroupe toutes les règles relatives aux structures (structs) Go dans le projet KTN.

## Table des matières

- [KTN-STRUCT-001 : Convention de nommage MixedCaps](#ktn-struct-001--convention-de-nommage-mixedcaps)
- [KTN-STRUCT-002 : Documentation godoc obligatoire](#ktn-struct-002--documentation-godoc-obligatoire)
- [KTN-STRUCT-003 : Documentation des champs exportés](#ktn-struct-003--documentation-des-champs-exportés)
- [KTN-STRUCT-004 : Limitation du nombre de champs](#ktn-struct-004--limitation-du-nombre-de-champs)

---

## KTN-STRUCT-001 : Convention de nommage MixedCaps

### Objectif
Les noms de structs doivent utiliser la convention MixedCaps (ou mixedCaps pour les privées), sans underscores.

### ❌ Interdit
```go
// Utilisation de snake_case
type user_config struct {
    Host string
    Port int
}

type api_client struct {
    BaseURL string
}

type database_connection struct {
    Host string
    Port int
}
```

### ✅ Requis
```go
// MixedCaps pour les structs exportées
type UserConfig struct {
    Host string
    Port int
}

type APIClient struct {
    BaseURL string
}

type DatabaseConnection struct {
    Host string
    Port int
}

// mixedCaps pour les structs privées
type userConfig struct {
    host string
    port int
}
```

### Détection
Le linter vérifie que tous les noms de structs suivent la convention MixedCaps et ne contiennent pas d'underscores.

---

## KTN-STRUCT-002 : Documentation godoc obligatoire

### Objectif
Toute struct doit avoir un commentaire godoc décrivant son rôle.

### ❌ Interdit
```go
// Pas de commentaire godoc
type UserConfig struct {
    Host string
    Port int
}

type APIClient struct {
    BaseURL string
}
```

### ✅ Requis
```go
// UserConfig contient la configuration utilisateur pour l'application.
type UserConfig struct {
    Host string
    Port int
}

// APIClient représente un client pour interagir avec l'API REST.
type APIClient struct {
    BaseURL string
}

// DatabaseConnection représente une connexion active à la base de données.
type DatabaseConnection struct {
    Host string
    Port int
}
```

### Détection
Le linter vérifie que chaque déclaration de struct a un commentaire godoc associé.

---

## KTN-STRUCT-003 : Documentation des champs exportés

### Objectif
Tous les champs exportés d'une struct doivent être documentés. Les champs privés n'ont pas besoin de commentaires.

### ❌ Interdit
```go
// UserConfig contient la configuration utilisateur.
type UserConfig struct {
    // Champs exportés sans commentaires
    Host string
    Port int
    Timeout int
}

// APIClient représente un client API.
type APIClient struct {
    BaseURL string  // Pas de commentaire
    Timeout int     // Pas de commentaire
}
```

### ✅ Requis
```go
// UserConfig contient la configuration utilisateur.
type UserConfig struct {
    // Host est l'hôte du serveur
    Host string
    // Port est le port d'écoute
    Port int
    // Timeout est le délai d'expiration en secondes
    Timeout int

    // Champs privés (pas de commentaire requis)
    internalState bool
}

// APIClient représente un client API.
type APIClient struct {
    // BaseURL est l'URL de base de l'API
    BaseURL string
    // Timeout est le délai d'expiration des requêtes
    Timeout int

    // Privé - pas besoin de commentaire
    httpClient interface{}
}
```

### Détection
Le linter vérifie que chaque champ exporté (commence par une majuscule) a un commentaire au-dessus.

---

## KTN-STRUCT-004 : Limitation du nombre de champs

### Objectif
Une struct ne doit pas avoir plus de 15 champs. Au-delà, décomposer en sous-structs.

### ❌ Interdit
```go
// ComplexUser a trop de champs (18 > 15).
type ComplexUser struct {
    // ID est l'identifiant unique
    ID string
    // Username est le nom d'utilisateur
    Username string
    // Email est l'adresse email
    Email string
    // FirstName est le prénom
    FirstName string
    // LastName est le nom de famille
    LastName string
    // PhoneNumber est le numéro de téléphone
    PhoneNumber string
    // Address est l'adresse
    Address string
    // City est la ville
    City string
    // ZipCode est le code postal
    ZipCode string
    // Country est le pays
    Country string
    // BirthDate est la date de naissance
    BirthDate string
    // CreatedAt est la date de création
    CreatedAt int64
    // UpdatedAt est la date de mise à jour
    UpdatedAt int64
    // LastLoginAt est la date de dernière connexion
    LastLoginAt int64
    // IsActive indique si l'utilisateur est actif
    IsActive bool
    // IsVerified indique si l'email est vérifié
    IsVerified bool
    // Roles liste les rôles
    Roles []string
    // Permissions liste les permissions
    Permissions []string
}
```

### ✅ Requis
```go
// UserBasicInfo contient les informations de base d'un utilisateur.
type UserBasicInfo struct {
    // ID est l'identifiant unique
    ID string
    // Username est le nom d'utilisateur
    Username string
    // Email est l'adresse email
    Email string
    // FirstName est le prénom
    FirstName string
    // LastName est le nom de famille
    LastName string
}

// UserContactInfo contient les informations de contact.
type UserContactInfo struct {
    // PhoneNumber est le numéro de téléphone
    PhoneNumber string
    // Address est l'adresse
    Address string
    // City est la ville
    City string
    // ZipCode est le code postal
    ZipCode string
    // Country est le pays
    Country string
}

// UserMetadata contient les métadonnées de l'utilisateur.
type UserMetadata struct {
    // BirthDate est la date de naissance
    BirthDate string
    // CreatedAt est la date de création
    CreatedAt int64
    // UpdatedAt est la date de mise à jour
    UpdatedAt int64
    // LastLoginAt est la date de dernière connexion
    LastLoginAt int64
}

// UserPermissions contient les permissions de l'utilisateur.
type UserPermissions struct {
    // IsActive indique si l'utilisateur est actif
    IsActive bool
    // IsVerified indique si l'email est vérifié
    IsVerified bool
    // Roles liste les rôles
    Roles []string
    // Permissions liste les permissions
    Permissions []string
}

// User représente un utilisateur complet avec toutes ses informations décomposées.
type User struct {
    // BasicInfo contient les informations de base
    BasicInfo UserBasicInfo
    // ContactInfo contient les informations de contact
    ContactInfo UserContactInfo
    // Metadata contient les métadonnées
    Metadata UserMetadata
    // Permissions contient les permissions
    Permissions UserPermissions
}
```

### Détection
Le linter compte le nombre de champs dans une struct (incluant les champs embedded) et signale si > 15.

---

## Tests

### Fichiers de violation (tests/source/rules_struct/)
- `ktn_struct_001_bad_naming.go` : 8 structs avec snake_case
- `ktn_struct_002_no_godoc.go` : 10 structs sans godoc
- `ktn_struct_003_fields_no_comment.go` : 10 structs avec champs non documentés
- `ktn_struct_004_too_many_fields.go` : 3 structs avec trop de champs

### Fichiers conformes (tests/target/rules_struct/)
- `ktn_struct_001_good_naming.go` : Nommage MixedCaps correct
- `ktn_struct_002_with_godoc.go` : Toutes les structs documentées
- `ktn_struct_003_fields_with_comments.go` : Tous les champs exportés documentés
- `ktn_struct_004_reasonable_fields.go` : Structs avec ≤15 champs ou bien décomposées

---

## Références

- [Effective Go - Naming](https://golang.org/doc/effective_go#names)
- [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments)
- [Uber Go Style Guide - Structs](https://github.com/uber-go/guide/blob/master/style.md#structs)
