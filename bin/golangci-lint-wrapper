#!/bin/bash
# Wrapper pour KTN-Linter (intégration VSCode)

LINTER_BIN="/workspace/builds/ktn-linter"

# Si le binaire n'existe pas, le construire
if [ ! -f "$LINTER_BIN" ]; then
    cd /workspace
    go build -buildvcs=false -o "$LINTER_BIN" ./cmd/ktn-linter 2>&1
fi

# Scanner tout le projet principal
cd /workspace
"$LINTER_BIN" lint --simple --no-color ./... 2>&1 || true

# Scanner tous les répertoires testdata en parallèle
find ./pkg/analyzer/ktn/*/testdata/src/* -maxdepth 0 -type d 2>/dev/null | while read dir; do
    (cd /workspace && "$LINTER_BIN" lint --simple --no-color "$dir" 2>&1) || true &
done
wait

exit 0
