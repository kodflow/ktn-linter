#!/bin/bash
# Wrapper pour KTN-Linter uniquement (pas de golangci-lint)

# Détecter si on analyse un fichier spécifique ou un pattern
FILE_ARG=""
PATTERN_ARG=""

for arg in "$@"; do
    # Ignorer les flags
    if [[ "$arg" == -* ]]; then
        continue
    fi

    # Fichier Go spécifique
    if [[ "$arg" == *.go ]] && [[ -f "$arg" ]]; then
        FILE_ARG="$arg"
        break
    fi

    # Pattern (./..., tests/, src/, etc.)
    if [[ "$arg" == *"..."* ]] || [[ "$arg" == *"/"* ]]; then
        PATTERN_ARG="$arg"
        break
    fi
done

# Exécuter ktn-linter
if [[ -n "$FILE_ARG" ]]; then
    /workspace/builds/ktn-linter -simple "$FILE_ARG" 2>&1 || true
elif [[ -n "$PATTERN_ARG" ]]; then
    /workspace/builds/ktn-linter -simple "$PATTERN_ARG" 2>&1 || true
else
    # Par défaut, analyser tout
    /workspace/builds/ktn-linter -simple ./... 2>&1 || true
fi

# Retourner 0 pour ne pas bloquer l'extension Go
exit 0

